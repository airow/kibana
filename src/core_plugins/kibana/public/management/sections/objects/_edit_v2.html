<kbn-management-app section="kibana">
  <kbn-management-objects-edit-v2 class="container-fluid">
    <h1>编辑查询方案</h1>
    <div class="form-group">
      <button class="btn btn-primary" ng-click="open()"><i aria-hidden="true" class="fa fa-eye"></i>在线设计</button>
      <button aria-label="Cancel" class="btn btn-primary" ng-click="cancel()">Cancel</button>
      <button aria-label="Save {{ title }} Object" class="btn btn-success" ng-click="restore()"
        ng-disabled="objectForm.$invalid || aceInvalidEditors.length !==0">Save {{ title }} Object</button>
      <button aria-label="Save {{ title }} Object" class="btn btn-success" ng-click="submit_source()"
        ng-disabled="objectForm.$invalid || aceInvalidEditors.length !==0">Save {{ title }} Object</button>
    </div>
    <div class="bs-callout bs-callout-danger" ng-if="notFound">
      <h4>There is a problem with that saved object</h4>

      <p ng-if="notFound === 'search'">The saved search associated with this object no longer exists.</p>
      <p ng-if="notFound === 'index-pattern'">The index pattern associated with this object no longer exists.</p>
      <p ng-if="notFound === 'index-pattern-field'">A field associated with this object no longer exists in the index pattern.</p>

      <p>If you know what this error means, go ahead and fix it - otherwise click the delete button above.</p>
    </div>
    <div class="bs-callout bs-callout-info" style="padding:auto;background-color:initial">
      <h4>基础配置</h4>
      <div class="row">
        <div class="row col-lg-12 col-sm-12 col-xs-12">
          <div class="col-lg-3 col-sm-3 col-xs-12">
            <div class="input-group">
              <span style="width: 100px;" class="input-group-addon">固定表头</span>
              <div class="checkbox">
                <label>
                  <input type="checkbox" ng-model='obj._source.uiConf.fixedHeader'>
                </label>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-sm-3 col-xs-12">
            <div class="input-group">
              <span style="width: 100px;" class="input-group-addon">时序图</span>
              <div class="checkbox">
                <label>
                  <input type="checkbox" ng-model='obj._source.uiConf.showTimeDiagram'>
                </label>
              </div>
            </div>
          </div>
        </div>
        <div class="row col-lg-12 col-sm-12 col-xs-12">
          <div class="col-lg-3 col-sm-3 col-xs-12">
            <div class="input-group">
              <span style="width: 100px;" class="input-group-addon">默认分页</span>
              <input type="number" class="form-control" placeholder="pageSize" ng-model='obj._source.uiConf.pageSize'>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="bs-callout bs-callout-info" style="padding:auto;background-color:initial">
      <h4>字段配置</h4>
      <div class="panel panel-default">
        <!-- <div class="panel-heading">字段配置</div> -->
        <table class="table table-striped table-hover">
          <colgroup>
            <col style="width: 70px;" />
            <col />
            <col style="width: 70px;" />
            <col />
            <col style="width: 70px;" ng-repeat="(key, value) in strategyConf" />
            <col style="width: 150px;" />
          </colgroup>
          <thead>
            <tr>
              <th>
                <span>序号</span>
              </th>
              <th>
                <span>字段</span>
              </th>
              <th>
                <span>显示</span>
              </th>
              <th>
                <span>数据权限</span>
              </th>
              <td ng-repeat="(key, value) in strategyConf">
                <span>{{value.name}}</span>
              </td>
              <th></th>
            </tr>
          </thead>
          <tbody>
            <tr ng-repeat="row in fieldRows">
              <td>
                <span ng-bind='$index+1'></span>
              </td>
              <td>
                <input type="text" ng-model="row.field" class="form-control" />
              </td>
              <td>
                <span>
                  <i aria-hidden="true" ng-click="row.display=!row.display"
                    ng-class="{true: 'fa-eye text-success', false: 'fa-eye-slash text-muted'}[row.display]" class="fa"></i>
                </span>
              </td>
              <td>
                <!-- 数据权限 -->
                <span ng-repeat="authObj in row.authObj track by $index">
                  <span
                    style="display: inline-block; margin: 5px; border-radius: 5px;background-color: blanchedalmond;padding: 5px;">
                    <span ng-bind="authObj"></span>
                    <i ng-click="colEditor(row.authObj,$index)" class="fa fa-edit" aria-hidden="true"></i>
                    <i ng-click="remove(row.authObj,$index)" class="fa fa-remove" aria-hidden="true"></i>
                  </span>
                  <span ng-if="!$last">,</span>
                </span>
                <i class="fa fa-plus" ng-click="colEditor(row.authObj)" aria-hidden="true"></i>
              </td>
              <td ng-repeat="(key, value) in strategyConf">
                <button class="btn btn-xs"
                  ng-class="{true:'btn-info',false:'btn-primary'}[strategyConfCount(row.strategyConfGroup,key)>0]"
                  ng-click="strategyConfEditor(row,key,row.strategyConfGroup[key])">
                  <span class="badge" ng-bind="strategyConfCount(row.strategyConfGroup,key)">0</span>
                </button>
              </td>
              <td>
                <button ng-disabled="$first" class="btn btn-xs btn-primary" ng-click="move(fieldRows,$index, $index-1)"><i
                    class="fa fa-arrow-up"></i></button>
                <button ng-disabled="$last" class="btn btn-xs btn-primary" ng-click="move(fieldRows, $index, $index+1)"><i
                    class="fa fa-arrow-down"></i></button>
                <button class="btn btn-xs btn-danger" ng-click="remove(fieldRows,$index)"><i
                    class="fa fa-trash-o"></i></button>
              </td>
            </tr>
          </tbody>
          <tfoot>
            <tr>
              <td>

              </td>
              <td>
                <input type="text" ng-model="newField.field" class="form-control" />
              </td>
              <td>
                <span>
                  <i aria-hidden="true" ng-click="newField.display=!newField.display"
                    ng-class="{true: 'fa-eye text-success', false: 'fa-eye-slash text-muted'}[!!newField.display]" class="fa"></i>
                </span>
              </td>
              <td>
                <!-- 数据权限 -->
                <span ng-repeat="authObj in newField.authObj track by $index">
                  <span style="display: inline-block; margin: 5px; border-radius: 5px;background-color: blanchedalmond;padding: 5px;">
                    <span ng-bind="authObj"></span>
                    <i ng-click="colEditor(newField.authObj,$index)" class="fa fa-edit" aria-hidden="true"></i>
                    <i ng-click="remove(newField.authObj,$index)" class="fa fa-remove" aria-hidden="true"></i>
                  </span>
                  <span ng-if="!$last">,</span>
                </span>
                <i class="fa fa-plus" ng-click="colEditor(newField.authObj)" aria-hidden="true"></i>
              </td>
              <td ng-repeat="(key, value) in strategyConf">
                <button class="btn btn-xs"
                  ng-class="{true:'btn-info',false:'btn-primary'}[strategyConfCount(newField.strategyConfGroup,key)>0]"
                  ng-click="strategyConfEditor(newField,key,newField.strategyConfGroup[key])">
                  <span class="badge" ng-bind="strategyConfCount(newField.strategyConfGroup,key)">0</span>
                </button>
              </td>
              <td>
                <button ng-disabled="$first" class="btn btn-xs btn-primary" ng-click="add()"><i aria-hidden="true"
                    class="fa fa-plus"></i></button>
                <button ng-disabled="$last" class="btn btn-xs btn-warning" ng-click="clear()"><i aria-hidden="true"
                    class="fa fa-remove"></i></button>
              </td>
            </tr>
          </tfoot>
          <!-- ngIf: showTotal -->
        </table>
      </div>
    </div>
  </kbn-management-objects-edit-v2>
</kbn-management-app>
